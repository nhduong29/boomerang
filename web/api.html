<!DOCTYPE html>
<html>
<head>
    <title>Boomerang - API</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="/styles/fontawesome/css/fontawesome-all.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/styles/__THEME__.css">
    <link rel="stylesheet" href="/CodeMirror/lib/codemirror.css">
    <link rel="stylesheet" href="/CodeMirror/theme/night.css">
    <link rel="stylesheet" href="/CodeMirror/theme/eclipse.css">
    <link rel="stylesheet" href="/CodeMirror/addon/simplescrollbars.css">
    <link rel="stylesheet" href="/jsTree/themes/default/style.css" />
    <link rel="icon" href="/styles/favicon.ico">
    <link rel="stylesheet" type="text/css" href="/styles/main.css">
    <link rel="stylesheet" type="text/css" href="/styles/style.css">
    
</head>
<body>
    <nav class="navbar navbar-inverse navbar-fixed-left">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Boomerang<img src="boomerang.svg" alt="Boomerang" /></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/">Home</a></li>
            <li><a href="/api" class="active">API Documentation</a></li>
            <li><a href="/about">About</a></li>
            <li><a href="/contact">Contact</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">References <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li class="dropdown-header">Sandbox</li>
                <li><a href="https://getsandbox.com/docs/definition-api" target="_blank">Sandbox Definition API</a></li>
                <li><a href="https://github.com/getsandbox/sandbox" target="_blank">Sandbox Runtime</a></li>
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Stream log</li>
                <li><a href="https://github.com/mthenw/frontail" target="_blank">tail -F with UI</a></li>
              </ul>
            </li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li>
              <form class="navbar-form" role="search" onkeypress="return event.keyCode != 13;">
                  <div class="form-group">
                      <input type="text" class="form-control query" placeholder="Filter" tabindex="1">
                  </div>
              </form>
            </li>
          </ul>
        </div>
        <div class="nav-footer text-center">
          <a class="fa fa-github" title="See me in Bibucket" target="_blank" href="https://bitbucket.org/aavn_nhduong/boomerang"></a>
        </div>
      </div>
    </nav>

    <div class="page-alerts">
      <div class="alert alert-success page-alert" id="success">
          <button type="button" class="close"><span aria-hidden="true">Ã—</span><span class="sr-only">Close</span></button>
          <strong>Cool!</strong> All changes are saved!!!.
      </div>
  </div>
    <div class="container api-container">
      <div class="row">
        <div class="col-lg-2 col-md-3">
          <div id="tree"></div>
        </div>
        <div class="col-lg-10 col-md-9">
          <textarea id="api"></textarea>
          <br/>
          <button data-toggle="page-alert" data-delay="3000" data-toggle-id="success" class="btn btn-default" id="save-api"><i class="fa fa-floppy-o"></i> Save Changes</button>
      </div>
    </div>

    <script src="/constant.js"></script>
    <script src="/jquery.min.js"></script>
    <script src="/bootstrap.min.js"></script>
    <script src="/renderjson.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/tinycon.min.js"></script>
    <script src="/ansi_up.js"></script>
    <script src="/app.js"></script>
    <script src="/CodeMirror/lib/codemirror.js"></script>
    <script src="/CodeMirror/selection/active-line.js"></script>
    <script src="/CodeMirror/edit/matchbrackets.js"></script>
    <!-- Code block highlighting modes -->
    <script src="/CodeMirror/mode/javascript/javascript.js"></script>
    <script src="/CodeMirror/addon/simplescrollbars.js"></script>
    <script src="/jsTree/jstree.js"></script>
    <script type="text/javascript">
      $('.page-alert').hide();
      var selectedNode = 'services/main.js';
      var editor = CodeMirror.fromTextArea(document.getElementById("api"), {
            lineNumbers: true,
            styleActiveLine: true,
            matchBrackets: true,
            scrollbarStyle: "simple",
            theme: "eclipse"
            /*theme: "night"*/
          });
      var socket = new io.connect('/' + '__NAMESPACE__');
      socket.on('api', function(data) {
        $('#api').html(data);
        editor.setValue(data);
      });

      socket.on('dirApi',function(data){
        console.log(data);
        traverse(data);
        $('#tree').jstree({ 'core' : {'data' : data}});
      });

      //Add the new font awesome icon
      $('#tree').on('ready.jstree click dblclick', function (e, data) {
          $('i.tree-folder').removeClass('jstree-themeicon jstree-icon').addClass('fa fa-folder-open');
          $('i.tree-file').removeClass('jstree-themeicon jstree-icon').addClass('fa fa-file-code-o');
      });

      // listen for event click on tree
      $('#tree').on('changed.jstree', function (e, data) {
        if(data.selected.length >= 1){
          var originalNode = data.instance.get_node(data.selected[0]).original;
          console.log(originalNode.path);
          if(originalNode && originalNode.type == 'file'){
            var filePath = data.instance.get_node(data.selected[0]).original.path;
            socket.emit('readApiFile', filePath);
            selectedNode = filePath;
          }
        }
      });

      $('#save-api').click(function(){
        editor.save();
        socket.emit('save', selectedNode, $('#api').val());
      });

      //Edit the json to show on jsTree
      var traverse = function(obj) {
        for (var i in obj) {
          if (i === 'name'){
            obj['text'] = obj[i];
            if(obj[i] === 'main.js'){
              obj['state'] =  {
                'selected' : true
              }
            }
          }
          if(i === 'type' && obj[i] == 'file') {
            obj['icon'] = 'tree-file';
          }else if(i === 'type' && obj[i] == 'directory') {
            obj['icon'] = 'tree-folder';
          }
          if (obj[i] !== null && typeof(obj[i])=="object") {
            traverse(obj[i]);
          }
        }
      }

    </script>
    <script src="/script.js"></script>
</body>
</html>
